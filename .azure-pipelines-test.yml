#
# Steps for building Jest. See jobs defined in .azure-pipelines.yml
#

steps:
  - checkout: none
    path: jest

  - task: Cache@2
    inputs:
      key: jest | "$(System.JobId)" | "$(Build.BuildId)" | $(Agent.OS)
      path: $(Pipeline.Workspace)/jest
    displayName: Restore cache

  # Run test-ci-partial
  - script: yarn run test-ci-partial
    displayName: 'Run tests'
    workingDirectory: $(Pipeline.Workspace)/jest

  # Publish CI test results
  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '$(Pipeline.Workspace)/jest/**/reports/junit/*.xml'
      testRunTitle: 'CI Tests $(Agent.OS)'
    displayName: 'Publish test results'
    condition: succeededOrFailed()
